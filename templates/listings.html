{# templates/listings.html #}
{% extends "base.html" %}
{% block title %}Ons Aanbod | Neo Lease{% endblock %}

{% block content %}
<section class="container" style="padding: 2rem 1rem;">
  <h1 style="color: #4c37c6; font-size: 2rem; margin-bottom: 1.5rem;">Ons aanbod</h1>

  <!-- FILTER BAR (EXAMPLE) -->
  <div class="filter-bar" style="margin-bottom: 2rem;">
    <!-- Form that performs a GET request to /listings -->
    <form action="{{ url_for('listings') }}" method="get" style="display: flex; flex-wrap: wrap; gap: 1rem;">
      
      <!-- 1) Free-text search (q) -->
      <input
        type="text"
        name="q"
        placeholder="Zoeken (bijv. 'GTI' of 'Panoramadak')"
        value="{{ current_q or '' }}"
        style="padding: 0.5rem; flex: 0 0 200px; max-width: 250px;"
      >

      <!-- 2) Merk dropdown from brand_choices (provided by app.py) -->
      <select
        name="brand"
        style="padding: 0.5rem; min-width: 160px;"
      >
        <option value="">- Kies een merk -</option>
        {% if brand_choices %}
          {% for b in brand_choices %}
            <option value="{{ b }}"
              {% if current_brand == b %} selected {% endif %}
            >
              {{ b }}
            </option>
          {% endfor %}
        {% endif %}
      </select>

    <!-- 3) Monthly budget filter (similar to homepage) -->
    <select
      name="monthly"
      style="padding: 0.5rem; min-width: 160px;"
    >
      <option value="">- Budget (p/m) -</option>
      <option value="1-99"
        {% if current_monthly == '1-99' %} selected {% endif %}
      >€1 - €99 p/m</option>
      <option value="100-199"
        {% if current_monthly == '100-199' %} selected {% endif %}
      >€100 - €199 p/m</option>
      <option value="200-299"
        {% if current_monthly == '200-299' %} selected {% endif %}
      >€200 - €299 p/m</option>
      <option value="300-399"
        {% if current_monthly == '300-399' %} selected {% endif %}
      >€300 - €399 p/m</option>
      <option value="400-499"
        {% if current_monthly == '400-499' %} selected {% endif %}
      >€400 - €499 p/m</option>
      <option value="500-599"
        {% if current_monthly == '500-599' %} selected {% endif %}
      >€500 - €599 p/m</option>
      <option value="600-699"
        {% if current_monthly == '600-699' %} selected {% endif %}
      >€600 - €699 p/m</option>
      <option value="700-799"
        {% if current_monthly == '700-799' %} selected {% endif %}
      >€700 - €799 p/m</option>
      <option value="800-899"
        {% if current_monthly == '800-899' %} selected {% endif %}
      >€800 - €899 p/m</option>
      <option value="900-999"
        {% if current_monthly == '900-999' %} selected {% endif %}
      >€900 - €999 p/m</option>
      <option value="1000+"
        {% if current_monthly == '1000+' %} selected {% endif %}
      >€1000 + p/m</option>
    </select>


      <!-- 4) Sort example (sort param) -->
      <select name="sort">
        <option value="">- Sorteer op -</option>
        <option value="price_asc"
          {% if current_sort == 'price_asc' %}selected{% endif %}
        >Prijs (Laag - Hoog)</option>
        <option value="price_desc"
          {% if current_sort == 'price_desc' %}selected{% endif %}
        >Prijs (Hoog - Laag)</option>
      </select>

      <!-- 5) Submit button -->
      <button
        type="submit"
        class="btn border"
        style="padding: 0.5rem 1rem;"
      >
        Filteren
      </button>
    </form>
  </div>
  
  <!-- Optional text showing how many results in total (if you pass pagination.total) -->
  {% if pagination.total %}
    <p style="margin-bottom: 1.5rem;">{{ pagination.total }} resultaten gevonden</p>
  {% endif %}
  
  <!-- CAR GRID -->
  <div class="car-grid" style="
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1rem;
  ">
    {% for car in cars %}
      <div class="car-card" style="border: 1px solid #ddd; padding: 1rem; border-radius: 6px;">
        
        <!-- Clickable image -->
        <a href="{{ url_for('car_detail', car_id=car.id) }}" style="display: block;">
          {% if car.images and car.images|length > 0 %}
            <img
              src="{{ car.images[0].image_url }}"
              alt="Car Image"
              style="width: 100%; height: auto; margin-bottom: 0.5rem;"
            >
          {% else %}
            <div style="background: #ccc; width: 100%; height: 150px; margin-bottom: 0.5rem;">
              Geen afbeelding
            </div>
          {% endif %}
        </a>

        <!-- Title text that underlines on hover -->
        <h3 style="font-size: 1.2rem;">
          <a
            href="{{ url_for('car_detail', car_id=car.id) }}"
            style="color: #4c37c6; text-decoration: none;"
            class="car-title-link"
          >
            {{ car.title or 'Onbekend' }}
          </a>
        </h3>

        <p style="color: #999; margin-bottom: 0.5rem;">{{ car.subtitle }}</p>
        <p style="margin-bottom: 0.5rem;">
          <strong>{{ car.financial_lease_price }}</strong> / {{ car.financial_lease_term }}
        </p>
        <p>Merk: {{ car.merk }}, Model: {{ car.model }}</p>
        
        <!-- “Meer info” button -->
        <a
          href="{{ url_for('car_detail', car_id=car.id) }}"
          style="display: inline-block; margin-top: 1rem;"
          class="btn border"
        >
          Meer info
        </a>
      </div>
    {% endfor %}
  </div>

  <!-- PAGINATION -->
  {% if page > 1 %}
    <a href="{{ url_for('listings', page=page-1,
                        brand=current_brand,
                        q=current_q,
                        monthly=current_monthly,
                        sort=request.args.get('sort')) }}">
      &laquo; Vorige
    </a>
  {% endif %}
  <span style="margin:0 1rem;">Pagina {{ page }} van {{ total_pages }}</span>
  {% if page < total_pages %}
    <a href="{{ url_for('listings', page=page+1,
                        brand=current_brand,
                        q=current_q,
                        monthly=current_monthly,
                        sort=request.args.get('sort')) }}">
      Volgende &raquo;
    </a>
  {% endif %}

  </div>
</section>
{% endblock %}
